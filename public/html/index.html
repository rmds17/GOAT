<!doctype html>
<html lang="pt">
<head>
  <meta charset="utf-8" />
  <title>GOAT — Gestão Organizada de Ativos e Trabalho</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="../css/style.css" />

  <!-- APS Viewer CSS -->
  <link rel="stylesheet"
        href="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.*/style.min.css"
        type="text/css">

  <style>
    body {
      margin: 0;
      background: #f6f7f9;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
    }

    /* BARRA DE CIMA */
    .app-header {
      height: 56px;
      padding: 0 18px;
      border-bottom: 1px solid #e3e5ea;
      background: #ffffff;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 1px 3px rgba(0,0,0,0.04);
    }

    .app-header-left {
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .logo {
      font-weight: 800;
      font-size: 20px;
      letter-spacing: 0.08em;
    }

    .logo-sub {
      font-size: 11px;
      color: #6b7280;
      text-transform: uppercase;
    }

    .app-header-right {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .btn {
      background: #0f62fe;
      color: #fff;
      padding: 6px 12px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      font-size: 13px;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn-ghost {
      background: transparent;
      color: #111827;
      border: 1px solid #d1d5db;
    }

    /* >>> LAYOUT ORIGINAL QUE JÁ FUNCIONAVA <<< */
    .layout {
      display: grid;
      grid-template-columns: 1.7fr 1fr;
      height: calc(100vh - 56px); /* viewport menos a barra de cima */
      gap: 0;
    }

    #viewerContainer {
      background: #f3f4f6;
      position: relative;
    }

    .right {
      background: #ffffff;
      overflow: auto;
      padding: 15px;
      border-left: 1px solid #ddd;
    }

    /* CARTÕES DO PAINEL DIREITO */

    .panel {
      border: 1px solid #e5e7eb;
      border-radius: 10px;
      padding: 10px 12px;
      background: #ffffff;
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.03);
    }

    .panel-header {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

        .prop-group-title {
      font-size: 13px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #374151;
      margin: 6px 0 4px;
    }

        .prop-group.general-info {
      background: #f9fafb;
      border-color: #e5e7eb;
    }

    .prop-group-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
    }

    .prop-group-body {
      margin-top: 4px;
    }

    .prop-group-arrow {
      font-size: 11px;
      color: #6b7280;
      transition: transform 0.15s ease;
    }

    .prop-group.collapsed .prop-group-body {
      display: none;
    }

    .prop-group.collapsed .prop-group-arrow {
      transform: rotate(-90deg);
    }

    .panel-header h2,
    .panel-header h3 {
      margin: 0;
      font-size: 15px;
    }

    .panel-subtitle {
      margin: 0;
      font-size: 11px;
      color: #6b7280;
    }

    .panel-body {
      font-size: 13px;
    }

    /* Item selecionado */

    .selected-summary {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 6px 12px;
      margin-bottom: 6px;
    }

    .selected-row {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .selected-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: #6b7280;
    }

    .selected-value {
      font-weight: 600;
      word-break: break-all;
    }

    .properties-placeholder {
      font-size: 12px;
      color: #9ca3af;
    }

    /* Filtros */

    .filters-body {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      font-size: 12px;
      background: #f9fafb;
    }

    .chip input {
      margin: 0;
    }

    /* URN + FORM + LISTA OT (reutiliza estilos base do style.css) */

    .urn-loader {
      margin-bottom: 10px;
      padding: 10px;
      background: #f0f5ff;
      border-radius: 8px;
      border: 1px solid #d0e0ff;
    }

    .urn-loader label {
      display: block;
      font-weight: 600;
      margin-bottom: 4px;
      font-size: 13px;
    }

    .urn-loader input {
      width: 100%;
      padding: 8px;
      margin: 6px 0;
      border: 1px solid #cbd5e1;
      border-radius: 6px;
      font-size: 12px;
    }

    .urn-loader button {
      width: 100%;
      padding: 8px;
      background: #0f62fe;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      font-size: 13px;
    }

    .urn-loader button:hover {
      background: #0052a3;
    }

    .form {
      display: grid;
      gap: 8px;
      margin-bottom: 10px;
    }

    .form label {
      font-size: 13px;
      display: grid;
      gap: 4px;
    }

    .form input,
    .form select,
    .form textarea {
      width: 100%;
      padding: 8px;
      border: 1px solid #dfe3e8;
      border-radius: 6px;
      font-size: 13px;
      resize: vertical;
    }

    .form button[type="submit"] {
      margin-top: 4px;
      background: #0f62fe;
      color: #fff;
      padding: 10px 12px;
      border: 0;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
    }

    .list-title {
      margin: 8px 0 4px;
      font-size: 14px;
    }

    .empty-state {
      font-size: 13px;
      color: #6b7280;
    }
  </style>
</head>

<body>
  <!-- BARRA TOP -->
  <header class="app-header">
    <div class="app-header-left">
      <span class="logo">GOAT</span>
      <span class="logo-sub">Gestão Organizada de Ativos e Trabalho</span>
    </div>
          <div class="app-header-right">
        <a href="/api/auth/login" class="btn btn-ghost">Login Autodesk</a>
        <button type="button" class="btn" onclick="openUrnModal()">
          Carregar modelo
        </button>
      </div>
  </header>

  <!-- LAYOUT PRINCIPAL (VIEWER + PAINEL) -->
  <div class="layout">
    <!-- Viewer (esquerda) -->
    <div id="viewerContainer"></div>

    <!-- Painel direito -->
    <section class="right">
      <!-- Item selecionado -->
        <div class="panel">
          <div class="panel-header">
            <h2>Item selecionado</h2>
            <p class="panel-subtitle">Propriedades BIM básicas do elemento selecionado no modelo.</p>
          </div>
          <div class="panel-body">
      <div class="selected-summary">
        <div class="selected-row">
          <span class="selected-label">GlobalId</span>
          <span id="picked-gid" class="selected-value">—</span>
        </div>
      <div class="selected-row">
        <span class="selected-label">Tipo</span>
        <span id="picked-type" class="selected-value">—</span>
      </div>
    </div>

  <!-- Lista de propriedades completa -->
  <div id="properties-list" class="properties-list">
    <em>Seleciona um elemento no modelo para ver as propriedades.</em>
  </div>
</div>

      </div>

      <!-- Filtros / visualização -->
      <div class="panel">
        <div class="panel-header">
          <h2>Filtros &amp; visualização</h2>
          <p class="panel-subtitle">Controlar destaque de elementos com OT e especialidades.</p>
        </div>
        <div class="panel-body filters-body">
          <label class="chip">
            <input type="checkbox" checked>
            Highlight itens com OT
          </label>
          <label class="chip">
            <input type="checkbox" checked>
            Mostrar “bubbles” de OT
          </label>
          <label class="chip">
            <input type="checkbox">
            Filtrar por especialidade
          </label>
        </div>
      </div>

      <!-- Ordens de Trabalho -->
      <div class="panel">
        <div class="panel-header">
          <h2>Ordens de Trabalho</h2>
          <p class="panel-subtitle">Criar e gerir OTs ligadas aos elementos do modelo.</p>
        </div>
        <div class="panel-body">
          <form id="wo-form" class="form">
            <label>
              Título
              <input id="f-title" required placeholder="Ex.: Porta não fecha" />
            </label>

            <label>
              Prioridade
              <select id="f-priority">
                <option>Low</option>
                <option selected>Medium</option>
                <option>High</option>
                <option>Urgent</option>
              </select>
            </label>

            <label>
              Data limite
              <input id="f-due" type="date" />
            </label>

            <label>
              Ativo / Zona
              <input id="f-asset" placeholder="Ex.: Bloco A - Piso 1" />
            </label>

            <label>
              Descrição
              <textarea id="f-desc" rows="3"
                        placeholder="Explica o problema e o que já foi observado..."></textarea>
            </label>

            <button type="submit">Criar OT</button>
          </form>

          <h3 class="list-title">OTs registadas</h3>
          <ul id="wo-list" class="wo-list"></ul>
          <p id="wo-empty" class="empty-state" style="display:none">Ainda não há OTs.</p>
        </div>
      </div>
    </section>
  </div>

    <!-- MODAL: CARREGAR MODELO 3D -->
  <div id="urn-modal" class="modal-backdrop" onclick="backdropClick(event)">
    <div class="modal" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h2>Carregar modelo 3D (URN)</h2>
        <button type="button" class="modal-close" onclick="closeUrnModal()">&times;</button>
      </div>
      <p class="modal-subtitle">
        Cole aqui o URN do modelo que queres visualizar no viewer.
      </p>

      <div class="urn-loader" style="margin-bottom: 0;">
        <label for="f-urn">URN do modelo</label>
        <input id="f-urn" type="text" placeholder="Cole aqui o URN do modelo..." />
        <button type="button" onclick="handleLoadModel(); closeUrnModal();">
          Carregar modelo
        </button>
      </div>
    </div>
  </div>

    <script>
    function openUrnModal() {
      var m = document.getElementById('urn-modal');
      if (m) {
        m.classList.add('open');
        // focus no input quando abrir
        setTimeout(function () {
          var input = document.getElementById('f-urn');
          if (input) input.focus();
        }, 50);
      }
    }

    function closeUrnModal() {
      var m = document.getElementById('urn-modal');
      if (m) {
        m.classList.remove('open');
      }
    }

    function backdropClick(e) {
      // clicar fora da caixa fecha o modal
      if (e.target.id === 'urn-modal') {
        closeUrnModal();
      }
    }
  </script>

  <!-- APS Viewer Library -->
  <script src="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.*/viewer3D.min.js"></script>

  <!-- Application Scripts -->
  <script src="../js/airtable.js"></script>
  <script src="../js/aps-viewer.js"></script>
</body>
</html>
